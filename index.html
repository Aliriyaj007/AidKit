<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AidKit ‚Ä¢ Offline First-Aid Guide</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ü©π</text></svg>">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Roboto+Mono:wght@400;500&display=swap">
    
    <style>
        /* ===== CSS RESET & BASE ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            /* Default theme (Light) - others defined in JavaScript */
            --primary-50: #e8f4ff;
            --primary-100: #cce4ff;
            --primary-500: #1a73e8;
            --primary-600: #0d62d9;
            --surface-0: #ffffff;
            --surface-50: #f8f9fa;
            --surface-100: #f1f3f4;
            --surface-200: #e8eaed;
            --surface-900: #202124;
            --text-primary: #202124;
            --text-secondary: #5f6368;
            --text-disabled: #9aa0a6;
            --success: #0d9d58;
            --warning: #f9ab00;
            --danger: #d93025;
            --border-radius-sm: 8px;
            --border-radius-md: 12px;
            --border-radius-lg: 16px;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.1);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.08);
            --shadow-lg: 0 8px 24px rgba(0,0,0,0.12);
            --transition-fast: 150ms ease;
            --transition-normal: 250ms ease;
            --font-sans: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            --font-mono: 'Roboto Mono', monospace;
        }

        body {
            font-family: var(--font-sans);
            background: var(--surface-50);
            color: var(--text-primary);
            line-height: 1.5;
            min-height: 100vh;
            transition: background-color var(--transition-normal);
            overflow-x: hidden;
        }

        /* ===== LAYOUT SYSTEM ===== */
        .app-container {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            max-width: 1600px;
            margin: 0 auto;
        }

        .app-header {
            padding: 1rem 1.5rem;
            background: var(--surface-0);
            border-bottom: 1px solid var(--surface-200);
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 1rem;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow-sm);
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr;
            flex: 1;
            padding: 1.5rem;
            gap: 1.5rem;
        }

        @media (min-width: 768px) {
            .main-content {
                grid-template-columns: 300px 1fr;
            }
        }

        @media (min-width: 1200px) {
            .main-content {
                grid-template-columns: 300px 1fr 350px;
            }
        }

        .app-footer {
            padding: 1.5rem;
            background: var(--surface-0);
            border-top: 1px solid var(--surface-200);
            text-align: center;
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        /* ===== COMPONENT STYLES ===== */
        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-weight: 700;
            font-size: 1.5rem;
            color: var(--primary-500);
        }

        .logo-icon {
            font-size: 2rem;
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            flex-wrap: wrap;
        }

        .btn {
            padding: 0.625rem 1.25rem;
            border: none;
            border-radius: var(--border-radius-md);
            font-family: var(--font-sans);
            font-weight: 500;
            font-size: 0.9375rem;
            cursor: pointer;
            transition: all var(--transition-fast);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            background: var(--surface-100);
            color: var(--text-primary);
        }

        .btn:hover {
            background: var(--surface-200);
            transform: translateY(-1px);
        }

        .btn-primary {
            background: var(--primary-500);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-600);
            box-shadow: var(--shadow-md);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            opacity: 0.9;
        }

        .btn-icon {
            padding: 0.5rem;
            border-radius: var(--border-radius-sm);
            min-width: auto;
        }

        .card {
            background: var(--surface-0);
            border-radius: var(--border-radius-lg);
            padding: 1.5rem;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--surface-200);
            transition: all var(--transition-normal);
        }

        .card:hover {
            box-shadow: var(--shadow-md);
        }

        .card-header {
            margin-bottom: 1.25rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .card-title-icon {
            font-size: 1.5rem;
        }

        .section-title {
            font-size: 0.875rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-secondary);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* ===== SIDEBAR ===== */
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .search-container {
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 0.875rem 1rem 0.875rem 2.75rem;
            border: 1px solid var(--surface-200);
            border-radius: var(--border-radius-md);
            font-family: var(--font-sans);
            font-size: 0.9375rem;
            background: var(--surface-0);
            color: var(--text-primary);
            transition: all var(--transition-fast);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary-500);
            box-shadow: 0 0 0 2px var(--primary-50);
        }

        .search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-disabled);
            pointer-events: none;
        }

        .procedure-list {
            list-style: none;
            overflow-y: auto;
            max-height: 500px;
        }

        .procedure-item {
            padding: 1rem;
            border-radius: var(--border-radius-md);
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: all var(--transition-fast);
            border-left: 3px solid transparent;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .procedure-item:hover {
            background: var(--surface-100);
        }

        .procedure-item.active {
            background: var(--primary-50);
            border-left-color: var(--primary-500);
        }

        .procedure-icon {
            font-size: 1.5rem;
            width: 2rem;
            text-align: center;
        }

        .procedure-info {
            flex: 1;
        }

        .procedure-name {
            font-weight: 500;
            margin-bottom: 0.25rem;
        }

        .procedure-desc {
            font-size: 0.8125rem;
            color: var(--text-secondary);
        }

        .urgency-badge {
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .urgency-critical { background: var(--danger); color: white; }
        .urgency-high { background: var(--warning); color: var(--text-primary); }
        .urgency-medium { background: var(--primary-100); color: var(--primary-600); }

        /* ===== MAIN CONTENT ===== */
        .procedure-detail {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .procedure-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .procedure-title {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .procedure-actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .steps-container {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .step-card {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.5rem;
            padding: 1.5rem;
            background: var(--surface-0);
            border-radius: var(--border-radius-lg);
            border: 1px solid var(--surface-200);
        }

        @media (min-width: 768px) {
            .step-card {
                grid-template-columns: 120px 1fr;
            }
        }

        .step-number {
            width: 60px;
            height: 60px;
            background: var(--primary-500);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: 700;
            margin: 0 auto;
        }

        .step-content {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .step-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .step-description {
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .step-illustration {
            background: var(--surface-50);
            border-radius: var(--border-radius-md);
            padding: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 150px;
            border: 1px solid var(--surface-200);
        }

        .illustration-svg {
            max-width: 100%;
            height: auto;
        }

        .warning-box {
            background: #FFF8E1;
            border-left: 4px solid var(--warning);
            padding: 1rem;
            border-radius: 0 var(--border-radius-md) var(--border-radius-md) 0;
            margin: 1rem 0;
        }

        .warning-title {
            font-weight: 600;
            color: #E65100;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* ===== RIGHT PANEL ===== */
        .right-panel {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .emergency-call-btn {
            width: 100%;
            padding: 1.25rem;
            font-size: 1.125rem;
            font-weight: 600;
            background: linear-gradient(135deg, var(--danger), #b71c1c);
            color: white;
            border: none;
            border-radius: var(--border-radius-lg);
            cursor: pointer;
            transition: all var(--transition-fast);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            box-shadow: var(--shadow-md);
        }

        .emergency-call-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .form-group {
            margin-bottom: 1.25rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text-primary);
        }

        .form-input,
        .form-textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--surface-200);
            border-radius: var(--border-radius-md);
            font-family: var(--font-sans);
            font-size: 0.9375rem;
            background: var(--surface-0);
            color: var(--text-primary);
            transition: all var(--transition-fast);
        }

        .form-input:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--primary-500);
            box-shadow: 0 0 0 2px var(--primary-50);
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }

        .contact-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .contact-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            background: var(--surface-100);
            border-radius: var(--border-radius-md);
            transition: all var(--transition-fast);
        }

        .contact-item:hover {
            background: var(--surface-200);
        }

        .contact-icon {
            font-size: 1.25rem;
            color: var(--primary-500);
        }

        .contact-info {
            flex: 1;
        }

        .contact-name {
            font-weight: 500;
            margin-bottom: 0.125rem;
        }

        .contact-number {
            font-size: 0.875rem;
            color: var(--text-secondary);
            font-family: var(--font-mono);
        }

        /* ===== MODALS ===== */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 1rem;
            backdrop-filter: blur(4px);
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: var(--surface-0);
            border-radius: var(--border-radius-lg);
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--surface-200);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-secondary);
            padding: 0.25rem;
            border-radius: var(--border-radius-sm);
        }

        .modal-close:hover {
            background: var(--surface-100);
        }

        .modal-body {
            padding: 1.5rem;
        }

        .modal-footer {
            padding: 1.5rem;
            border-top: 1px solid var(--surface-200);
            display: flex;
            justify-content: flex-end;
            gap: 0.75rem;
        }

        /* ===== THEME SELECTOR ===== */
        .theme-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .theme-option {
            padding: 1rem;
            border-radius: var(--border-radius-md);
            cursor: pointer;
            transition: all var(--transition-fast);
            border: 2px solid transparent;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            align-items: center;
            background: var(--surface-100);
        }

        .theme-option:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .theme-option.active {
            border-color: var(--primary-500);
            background: var(--surface-0);
        }

        .theme-preview {
            width: 100%;
            height: 60px;
            border-radius: var(--border-radius-sm);
        }

        .theme-name {
            font-weight: 500;
            font-size: 0.875rem;
        }

        /* ===== UTILITY CLASSES ===== */
        .hidden {
            display: none !important;
        }

        .visually-hidden {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        .text-center { text-align: center; }
        .text-muted { color: var(--text-secondary); }
        .mt-1 { margin-top: 0.5rem; }
        .mt-2 { margin-top: 1rem; }
        .mb-1 { margin-bottom: 0.5rem; }
        .mb-2 { margin-bottom: 1rem; }

        /* ===== PRINT STYLES ===== */
        @media print {
            .app-header,
            .sidebar,
            .right-panel,
            .procedure-actions,
            .app-footer {
                display: none !important;
            }

            .main-content {
                grid-template-columns: 1fr !important;
                padding: 0;
            }

            .card {
                box-shadow: none !important;
                border: 1px solid #ddd !important;
                break-inside: avoid;
            }

            .step-card {
                grid-template-columns: 1fr !important;
                border: 1px solid #ddd !important;
                margin-bottom: 1rem;
            }

            .step-number {
                background: #333 !important;
                color: white !important;
                -webkit-print-color-adjust: exact;
            }

            body {
                background: white !important;
                color: black !important;
            }
        }

        /* ===== DARK THEME OVERRIDES ===== */
        .theme-dark {
            --surface-0: #1e1e1e;
            --surface-50: #2d2d2d;
            --surface-100: #3d3d3d;
            --surface-200: #4a4a4a;
            --surface-900: #ffffff;
            --text-primary: #ffffff;
            --text-secondary: #b0b0b0;
            --text-disabled: #6d6d6d;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <div class="logo">
                <span class="logo-icon">ü©π</span>
                <span>AidKit</span>
            </div>
            
            <div class="header-controls">
                <button class="btn btn-icon" id="themeBtn" title="Change theme">
                    üé®
                </button>
                <button class="btn btn-icon" id="settingsBtn" title="Settings">
                    ‚öôÔ∏è
                </button>
                <button class="btn btn-icon" id="exportBtn" title="Export data">
                    üíæ
                </button>
                <button class="btn btn-icon" id="guideBtn" title="User guide">
                    ‚ùì
                </button>
                <button class="btn btn-primary" id="offlineBtn">
                    üì• Save Offline
                </button>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Left Sidebar -->
            <aside class="sidebar">
                <div class="card">
                    <div class="search-container">
                        <span class="search-icon">üîç</span>
                        <input type="text" 
                               class="search-input" 
                               id="searchInput" 
                               placeholder="Search procedures...">
                    </div>
                </div>

                <div class="card">
                    <h2 class="card-title">
                        <span class="card-title-icon">üìã</span>
                        Emergency Procedures
                    </h2>
                    <ul class="procedure-list" id="procedureList">
                        <!-- Dynamic content -->
                    </ul>
                </div>
            </aside>

            <!-- Center Content -->
            <section class="procedure-detail">
                <div class="card">
                    <div class="procedure-header">
                        <h1 class="procedure-title" id="currentProcedureTitle">Select a Procedure</h1>
                        <div class="procedure-actions">
                            <button class="btn" id="printBtn">
                                üñ®Ô∏è Print
                            </button>
                            <button class="btn" id="audioBtn">
                                üîä Audio
                            </button>
                            <button class="btn" id="timerBtn">
                                ‚è±Ô∏è Timer
                            </button>
                        </div>
                    </div>
                    
                    <div class="steps-container" id="stepsContainer">
                        <div class="text-center text-muted mt-2">
                            Select a procedure from the list to view instructions
                        </div>
                    </div>
                </div>
            </section>

            <!-- Right Panel -->
            <aside class="right-panel">
                <button class="emergency-call-btn" id="emergencyCallBtn">
                    üö® CALL 911
                </button>

                <div class="card">
                    <h3 class="section-title">
                        <span>üìù</span>
                        Personal Medical Notes
                    </h3>
                    <div class="form-group">
                        <textarea class="form-textarea" 
                                  id="medicalNotes" 
                                  placeholder="Enter allergies, medications, or other important medical information..."></textarea>
                    </div>
                    <div class="text-muted text-center">
                        This information will be included when printing procedures
                    </div>
                </div>

                <div class="card">
                    <h3 class="section-title">
                        <span>üìû</span>
                        Emergency Contacts
                    </h3>
                    <div class="contact-list" id="contactList">
                        <!-- Dynamic content -->
                    </div>
                    <button class="btn btn-icon" id="addContactBtn" style="width: 100%; margin-top: 1rem;">
                        Ôºã Add Contact
                    </button>
                </div>
            </aside>
        </main>

        <!-- Footer -->
        <footer class="app-footer">
            <p>Made with ‚ù§Ô∏è by <a href="https://github.com/Aliriyaj007" target="_blank">Aliriyaj007</a></p>
            <p class="text-muted mt-1">This is a fully offline-capable first-aid guide. Save this page for offline access.</p>
        </footer>
    </div>

    <!-- Modals -->
    <div class="modal-overlay" id="themeModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Select Theme</h2>
                <button class="modal-close" id="closeThemeModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="theme-grid" id="themeGrid">
                    <!-- Dynamic content -->
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="settingsModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Settings</h2>
                <button class="modal-close" id="closeSettingsModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Animation Speed</label>
                    <select class="form-input" id="animationSpeed">
                        <option value="fast">Fast</option>
                        <option value="normal" selected>Normal</option>
                        <option value="slow">Slow</option>
                        <option value="none">None</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Default View</label>
                    <select class="form-input" id="defaultView">
                        <option value="list">Procedure List</option>
                        <option value="detail" selected>Last Viewed</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">
                        <input type="checkbox" id="autoSave" checked>
                        Auto-save changes
                    </label>
                </div>
                
                <div class="form-group">
                    <label class="form-label">
                        <input type="checkbox" id="largeText">
                        Large text mode
                    </label>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" id="resetSettingsBtn">
                    Reset to Defaults
                </button>
                <button class="btn btn-primary" id="saveSettingsBtn">
                    Save Settings
                </button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="guideModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">User Guide</h2>
                <button class="modal-close" id="closeGuideModal">&times;</button>
            </div>
            <div class="modal-body">
                <h3>Welcome to AidKit</h3>
                <p>AidKit is a fully offline-capable first-aid guide designed for emergencies when internet access may not be available.</p>
                
                <h4>üö® Getting Started</h4>
                <ul>
                    <li><strong>Save Offline:</strong> Click "Save Offline" to ensure the app works without internet</li>
                    <li><strong>Browse Procedures:</strong> Select any procedure from the left sidebar</li>
                    <li><strong>Emergency Call:</strong> Use the red button to quickly call emergency services</li>
                </ul>
                
                <h4>üõ†Ô∏è Key Features</h4>
                <ul>
                    <li><strong>Search:</strong> Find procedures quickly using the search bar</li>
                    <li><strong>Audio Guide:</strong> Listen to procedure steps (requires device support)</li>
                    <li><strong>Timer:</strong> Built-in timer for timed procedures like CPR</li>
                    <li><strong>Print:</strong> Generate printer-friendly versions of procedures</li>
                </ul>
                
                <h4>‚öôÔ∏è Customization</h4>
                <ul>
                    <li><strong>Themes:</strong> Choose from 7 color themes</li>
                    <li><strong>Contacts:</strong> Add/edit emergency contact numbers</li>
                    <li><strong>Medical Notes:</strong> Add personal medical information</li>
                </ul>
                
                <h4>üíæ Data Management</h4>
                <ul>
                    <li><strong>Export:</strong> Save all your data (contacts, notes) to a JSON file</li>
                    <li><strong>Import:</strong> Restore previously exported data</li>
                    <li><strong>Auto-save:</strong> Changes are automatically saved to your browser</li>
                </ul>
                
                <p class="text-muted mt-2"><strong>Note:</strong> This is an educational tool. In real emergencies, always call professional medical help first.</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="closeGuideBtn">
                    Got it!
                </button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="timerModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Procedure Timer</h2>
                <button class="modal-close" id="closeTimerModal">&times;</button>
            </div>
            <div class="modal-body">
                <div style="text-align: center; padding: 2rem;">
                    <div style="font-size: 4rem; font-weight: 700; color: var(--primary-500);" id="timerDisplay">
                        02:00
                    </div>
                    <div style="font-size: 1.25rem; color: var(--text-secondary); margin: 1rem 0;">
                        CPR Compression Cycle
                    </div>
                </div>
                <div style="display: flex; gap: 1rem; justify-content: center;">
                    <button class="btn btn-primary" id="startTimerBtn">
                        ‚ñ∂Ô∏è Start
                    </button>
                    <button class="btn" id="pauseTimerBtn">
                        ‚è∏Ô∏è Pause
                    </button>
                    <button class="btn btn-danger" id="resetTimerBtn">
                        üîÑ Reset
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Import/Export UI (hidden) -->
    <input type="file" id="importFile" accept=".json" class="hidden">
    
    <script>
        // ===== APPLICATION STATE MODULE =====
        const AppState = (() => {
            let state = {
                currentProcedure: null,
                procedures: [
                    {
                        id: 'cpr',
                        name: 'CPR (Adult)',
                        description: 'Cardiopulmonary resuscitation for adults',
                        icon: 'üíì',
                        urgency: 'critical',
                        steps: [
                            {
                                title: 'Check Responsiveness',
                                description: 'Tap the person\'s shoulder and shout "Are you OK?" to see if they respond.',
                                illustration: 'üëã‚Üíüë§'
                            },
                            {
                                title: 'Call Emergency Services',
                                description: 'If unresponsive, call 911 or ask someone else to call. Get an AED if available.',
                                illustration: 'üìû‚Üíüöë'
                            },
                            {
                                title: 'Open Airway',
                                description: 'Place the person on their back. Tilt head back slightly and lift chin.',
                                illustration: 'üë§‚Üë'
                            },
                            {
                                title: 'Check Breathing',
                                description: 'Look for chest movement, listen for breath sounds, feel for air on your cheek.',
                                illustration: 'üëÇüëÄ'
                            },
                            {
                                title: 'Begin Compressions',
                                description: 'Place heel of one hand on center of chest, other hand on top. Push hard and fast (100-120 compressions per minute).',
                                illustration: 'üëê‚Üì‚Üë'
                            },
                            {
                                title: 'Give Rescue Breaths',
                                description: 'After 30 compressions, give 2 rescue breaths. Pinch nose shut, make complete seal over mouth, blow for 1 second.',
                                illustration: 'üëÑüí®'
                            }
                        ],
                        warning: 'Do not stop CPR except to use an AED or if the person starts breathing normally.'
                    },
                    {
                        id: 'choking',
                        name: 'Choking (Adult)',
                        description: 'First aid for choking conscious adults',
                        icon: 'ü§≠',
                        urgency: 'critical',
                        steps: [
                            {
                                title: 'Determine Severity',
                                description: 'Ask "Are you choking?" If they can cough or speak, encourage coughing.',
                                illustration: 'üó£Ô∏è‚ùì'
                            },
                            {
                                title: 'Perform Abdominal Thrusts',
                                description: 'Stand behind person. Wrap arms around waist. Make fist with one hand, place thumb side against abdomen. Grab fist with other hand and give quick upward thrusts.',
                                illustration: 'üëê‚Üë'
                            },
                            {
                                title: 'Continue Thrusts',
                                description: 'Continue abdominal thrusts until object is expelled or person becomes unconscious.',
                                illustration: 'üîÑ‚Üë'
                            }
                        ],
                        warning: 'If person becomes unconscious, begin CPR.'
                    },
                    {
                        id: 'bleeding',
                        name: 'Severe Bleeding',
                        description: 'Control life-threatening bleeding',
                        icon: 'ü©∏',
                        urgency: 'critical',
                        steps: [
                            {
                                title: 'Apply Direct Pressure',
                                description: 'Use a clean cloth or bandage to apply firm, direct pressure on the wound.',
                                illustration: '‚úã‚Üíü©π'
                            },
                            {
                                title: 'Elevate the Injury',
                                description: 'Raise the injured area above heart level if possible.',
                                illustration: 'üëÜ‚ù§Ô∏è'
                            },
                            {
                                title: 'Add More Dressing',
                                description: 'If blood soaks through, add more dressing on top. Do not remove original dressing.',
                                illustration: 'ü©π‚ûï'
                            }
                        ],
                        warning: 'If an object is embedded in the wound, do not remove it. Apply pressure around the object.'
                    },
                    {
                        id: 'burns',
                        name: 'Burns',
                        description: 'Treatment for thermal burns',
                        icon: 'üî•',
                        urgency: 'high',
                        steps: [
                            {
                                title: 'Cool the Burn',
                                description: 'Hold burned area under cool running water for 10-15 minutes.',
                                illustration: 'üíß‚Üíüî•'
                            },
                            {
                                title: 'Protect the Burn',
                                description: 'Cover with sterile non-adhesive bandage or clean cloth.',
                                illustration: 'ü©π‚Üíüî•'
                            }
                        ],
                        warning: 'Do not use ice, break blisters, or apply ointments to severe burns.'
                    },
                    {
                        id: 'stroke',
                        name: 'Stroke Recognition',
                        description: 'Identify signs of stroke',
                        icon: 'üß†',
                        urgency: 'critical',
                        steps: [
                            {
                                title: 'Face Drooping',
                                description: 'Ask person to smile. Does one side of face droop?',
                                illustration: 'üòê‚Üíüòî'
                            },
                            {
                                title: 'Arm Weakness',
                                description: 'Ask person to raise both arms. Does one arm drift downward?',
                                illustration: '‚úã‚Üì'
                            },
                            {
                                title: 'Speech Difficulty',
                                description: 'Ask person to repeat a simple phrase. Is speech slurred or strange?',
                                illustration: 'üó£Ô∏è‚ùì'
                            },
                            {
                                title: 'Time to Call 911',
                                description: 'If any of these signs are present, call 911 immediately.',
                                illustration: 'üìûüöë'
                            }
                        ],
                        warning: 'Time is critical. Note when symptoms first appeared.'
                    },
                    // Previous 16 procedures
                    {
                        id: 'seizure',
                        name: 'Seizure',
                        description: 'First aid during a seizure',
                        icon: 'üåÄ',
                        urgency: 'high',
                        steps: [
                            {
                                title: 'Clear the Area',
                                description: 'Move hard or sharp objects away from the person.',
                                illustration: 'üö´üî™'
                            },
                            {
                                title: 'Cushion the Head',
                                description: 'Place something soft under their head.',
                                illustration: 'üõèÔ∏èüß†'
                            },
                            {
                                title: 'Turn on Side',
                                description: 'Gently roll the person onto their side to help breathing.',
                                illustration: 'üë§‚Ü™Ô∏è'
                            },
                            {
                                title: 'Time the Seizure',
                                description: 'Note how long the seizure lasts.',
                                illustration: '‚è±Ô∏èüìù'
                            }
                        ],
                        warning: 'Do not put anything in the person\'s mouth or restrain them.'
                    },
                    {
                        id: 'heart-attack',
                        name: 'Heart Attack',
                        description: 'Recognize and respond to heart attack',
                        icon: '‚ù§Ô∏è',
                        urgency: 'critical',
                        steps: [
                            {
                                title: 'Call Emergency Services',
                                description: 'Call 911 immediately if you suspect a heart attack.',
                                illustration: 'üìûüöë'
                            },
                            {
                                title: 'Help Person Rest',
                                description: 'Have the person sit down and rest comfortably.',
                                illustration: 'üë§ü™ë'
                            },
                            {
                                title: 'Loosen Tight Clothing',
                                description: 'Loosen any tight clothing around neck and waist.',
                                illustration: 'üëîüîì'
                            },
                            {
                                title: 'Give Aspirin if Available',
                                description: 'If not allergic, give one regular aspirin to chew.',
                                illustration: 'üíäüòñ'
                            }
                        ],
                        warning: 'Do not wait to see if symptoms go away. Every minute counts.'
                    },
                    {
                        id: 'anaphylaxis',
                        name: 'Severe Allergic Reaction',
                        description: 'Emergency treatment for anaphylaxis',
                        icon: 'üö´',
                        urgency: 'critical',
                        steps: [
                            {
                                title: 'Use Epinephrine Auto-Injector',
                                description: 'If available, use the person\'s epinephrine auto-injector immediately.',
                                illustration: 'üíâüí®'
                            },
                            {
                                title: 'Call Emergency Services',
                                description: 'Call 911 even if symptoms improve after epinephrine.',
                                illustration: 'üìûüöë'
                            },
                            {
                                title: 'Help Person Lie Down',
                                description: 'Have them lie flat with feet elevated unless breathing is difficult.',
                                illustration: 'üë§‚¨áÔ∏è'
                            },
                            {
                                title: 'Monitor Breathing',
                                description: 'Check for breathing difficulties and be ready to perform CPR.',
                                illustration: 'üëÇüëÄ'
                            }
                        ],
                        warning: 'Do not wait to see if symptoms improve on their own.'
                    },
                    {
                        id: 'fracture',
                        name: 'Broken Bone',
                        description: 'First aid for suspected fractures',
                        icon: 'ü¶¥',
                        urgency: 'high',
                        steps: [
                            {
                                title: 'Immobilize the Area',
                                description: 'Keep the injured area from moving using a splint or sling.',
                                illustration: 'ü©πü¶¥'
                            },
                            {
                                title: 'Apply Ice Pack',
                                description: 'Apply ice wrapped in cloth to reduce swelling.',
                                illustration: '‚ùÑÔ∏èü¶¥'
                            },
                            {
                                title: 'Elevate if Possible',
                                description: 'Raise the injured limb above heart level if feasible.',
                                illustration: 'üëÜ‚ù§Ô∏è'
                            },
                            {
                                title: 'Get Medical Help',
                                description: 'Seek professional medical attention promptly.',
                                illustration: 'üè•üë®‚Äç‚öïÔ∏è'
                            }
                        ],
                        warning: 'Do not try to realign the bone or push a protruding bone back in.'
                    },
                    {
                        id: 'sprain',
                        name: 'Sprain or Strain',
                        description: 'Treat joint injuries',
                        icon: 'ü¶µ',
                        urgency: 'medium',
                        steps: [
                            {
                                title: 'Rest the Injury',
                                description: 'Avoid using the injured area.',
                                illustration: '‚õîü¶µ'
                            },
                            {
                                title: 'Ice Application',
                                description: 'Apply ice for 20 minutes every 2-3 hours for first 48 hours.',
                                illustration: '‚ùÑÔ∏è‚è±Ô∏è'
                            },
                            {
                                title: 'Compression',
                                description: 'Wrap with elastic bandage to reduce swelling.',
                                illustration: 'ü©πüåÄ'
                            },
                            {
                                title: 'Elevation',
                                description: 'Keep injured area raised above heart level.',
                                illustration: '‚¨ÜÔ∏è‚ù§Ô∏è'
                            }
                        ],
                        warning: 'Do not apply heat in the first 48 hours as it increases swelling.'
                    },
                    {
                        id: 'heat-stroke',
                        name: 'Heat Stroke',
                        description: 'Emergency cooling for heat stroke',
                        icon: 'üå°Ô∏è',
                        urgency: 'critical',
                        steps: [
                            {
                                title: 'Call Emergency Services',
                                description: 'Heat stroke is a medical emergency. Call 911 immediately.',
                                illustration: 'üìûüöë'
                            },
                            {
                                title: 'Move to Cool Area',
                                description: 'Get the person into shade or air conditioning.',
                                illustration: 'üë§üå≥'
                            },
                            {
                                title: 'Cool Rapidly',
                                description: 'Use cool water, wet cloths, or ice packs on neck, armpits, and groin.',
                                illustration: 'üíßüßä'
                            },
                            {
                                title: 'Monitor Consciousness',
                                description: 'Watch for changes in consciousness and be ready for CPR.',
                                illustration: 'üëÄüß†'
                            }
                        ],
                        warning: 'Do not give the person anything to drink if they are unconscious.'
                    },
                    {
                        id: 'hypothermia',
                        name: 'Hypothermia',
                        description: 'Warming for dangerously low body temperature',
                        icon: 'ü•∂',
                        urgency: 'critical',
                        steps: [
                            {
                                title: 'Move to Warm Area',
                                description: 'Get the person indoors or to a sheltered place.',
                                illustration: 'üë§üè†'
                            },
                            {
                                title: 'Remove Wet Clothing',
                                description: 'Gently remove wet clothes and replace with dry layers.',
                                illustration: 'üëï‚û°Ô∏èüëï'
                            },
                            {
                                title: 'Warm Gradually',
                                description: 'Use blankets and skin-to-skin contact under dry layers.',
                                illustration: 'üõèÔ∏èü§ó'
                            },
                            {
                                title: 'Give Warm Beverage',
                                description: 'If conscious, give warm, non-alcoholic, non-caffeinated drink.',
                                illustration: '‚òïüë§'
                            }
                        ],
                        warning: 'Do not use direct heat or hot water as it can damage skin or cause heart issues.'
                    },
                    {
                        id: 'poisoning',
                        name: 'Poison Ingestion',
                        description: 'Responding to poison exposure',
                        icon: '‚ò†Ô∏è',
                        urgency: 'critical',
                        steps: [
                            {
                                title: 'Call Poison Control',
                                description: 'Call 1-800-222-1222 (US) or your local poison control center.',
                                illustration: 'üìû‚ò†Ô∏è'
                            },
                            {
                                title: 'Check Breathing',
                                description: 'If person is unconscious or not breathing, call 911 and start CPR.',
                                illustration: 'üëÇüëÄ'
                            },
                            {
                                title: 'Save the Container',
                                description: 'Keep the poison container to show medical professionals.',
                                illustration: 'üß¥üíæ'
                            },
                            {
                                title: 'Do Not Induce Vomiting',
                                description: 'Unless directed by poison control, do not make the person vomit.',
                                illustration: '‚õîü§Æ'
                            }
                        ],
                        warning: 'Do not give anything by mouth unless directed by poison control.'
                    },
                    {
                        id: 'drowning',
                        name: 'Drowning Response',
                        description: 'Rescue and first aid for drowning',
                        icon: 'üåä',
                        urgency: 'critical',
                        steps: [
                            {
                                title: 'Ensure Safety First',
                                description: 'Only enter water if trained and safe to do so. Use reaching or throwing aids first.',
                                illustration: 'üõüüåä'
                            },
                            {
                                title: 'Remove from Water',
                                description: 'Get the person to dry land as quickly and safely as possible.',
                                illustration: 'üë§üèñÔ∏è'
                            },
                            {
                                title: 'Check for Breathing',
                                description: 'If not breathing, begin CPR immediately. Do not try to drain water from lungs.',
                                illustration: 'üëÇüí®'
                            },
                            {
                                title: 'Keep Person Warm',
                                description: 'Remove wet clothes and cover with dry blankets.',
                                illustration: 'üëïüõèÔ∏è'
                            }
                        ],
                        warning: 'Never attempt a water rescue if you are not trained or if conditions are dangerous.'
                    },
                    {
                        id: 'electric-shock',
                        name: 'Electric Shock',
                        description: 'First aid for electrical injuries',
                        icon: '‚ö°',
                        urgency: 'critical',
                        steps: [
                            {
                                title: 'Turn Off Power',
                                description: 'If safe to do so, turn off the power source. Do not touch the person if they\'re still connected.',
                                illustration: 'üîå‚ùå'
                            },
                            {
                                title: 'Call Emergency Services',
                                description: 'Call 911 immediately for any electrical shock injury.',
                                illustration: 'üìûüöë'
                            },
                            {
                                title: 'Check Breathing',
                                description: 'If not breathing, begin CPR immediately.',
                                illustration: 'üëÇüí®'
                            },
                            {
                                title: 'Treat Burns',
                                description: 'Cover any burns with sterile dressing. Do not use ointments.',
                                illustration: 'ü©πüî•'
                            }
                        ],
                        warning: 'Do not touch someone still connected to electricity with bare hands.'
                    },
                    {
                        id: 'eye-injury',
                        name: 'Eye Injury',
                        description: 'Emergency eye care',
                        icon: 'üëÅÔ∏è',
                        urgency: 'high',
                        steps: [
                            {
                                title: 'Do Not Rub Eye',
                                description: 'Keep hands away from the injured eye.',
                                illustration: '‚úã‚õîüëÅÔ∏è'
                            },
                            {
                                title: 'Flush Chemical Exposure',
                                description: 'For chemicals, flush with clean water for at least 20 minutes.',
                                illustration: 'üíßüëÅÔ∏è'
                            },
                            {
                                title: 'Cover Both Eyes',
                                description: 'Cover both eyes with a sterile dressing to prevent movement.',
                                illustration: 'ü©πüëÅÔ∏èüëÅÔ∏è'
                            },
                            {
                                title: 'Seek Immediate Care',
                                description: 'Get to an emergency room or eye specialist immediately.',
                                illustration: 'üè•üë®‚Äç‚öïÔ∏è'
                            }
                        ],
                        warning: 'Do not try to remove any object embedded in the eye.'
                    },
                    {
                        id: 'nosebleed',
                        name: 'Severe Nosebleed',
                        description: 'Stop persistent nose bleeding',
                        icon: 'üëÉ',
                        urgency: 'medium',
                        steps: [
                            {
                                title: 'Sit Up and Lean Forward',
                                description: 'Keep head above heart and lean slightly forward to prevent swallowing blood.',
                                illustration: 'üë§‚¨ÜÔ∏è‚¨áÔ∏è'
                            },
                            {
                                title: 'Pinch Nostrils',
                                description: 'Pinch soft part of nose for 10-15 minutes without releasing.',
                                illustration: 'ü§èüëÉ'
                            },
                            {
                                title: 'Apply Ice',
                                description: 'Place ice pack on bridge of nose and cheeks.',
                                illustration: 'üßäüëÉ'
                            },
                            {
                                title: 'Seek Medical Help',
                                description: 'If bleeding continues after 20 minutes, seek emergency care.',
                                illustration: 'üè•üë®‚Äç‚öïÔ∏è'
                            }
                        ],
                        warning: 'Do not tilt head back as this can cause blood to flow down throat.'
                    },
                    {
                        id: 'snake-bite',
                        name: 'Snake Bite',
                        description: 'First aid for venomous snake bites',
                        icon: 'üêç',
                        urgency: 'critical',
                        steps: [
                            {
                                title: 'Call Emergency Services',
                                description: 'Call 911 immediately. Try to remember the snake\'s appearance.',
                                illustration: 'üìûüöë'
                            },
                            {
                                title: 'Keep Person Calm',
                                description: 'Help them stay calm and still to slow venom spread.',
                                illustration: 'üòå‚õîüèÉ'
                            },
                            {
                                title: 'Position Below Heart',
                                description: 'Keep the bite area at or below heart level if possible.',
                                illustration: 'üë§‚¨áÔ∏è‚ù§Ô∏è'
                            },
                            {
                                title: 'Remove Tight Items',
                                description: 'Remove jewelry or tight clothing near the bite area.',
                                illustration: 'üíçüîì'
                            }
                        ],
                        warning: 'Do not cut the wound, try to suck out venom, or apply ice or a tourniquet.'
                    },
                    {
                        id: 'bee-sting-allergy',
                        name: 'Bee Sting (Allergic)',
                        description: 'Emergency response to severe insect sting allergy',
                        icon: 'üêù',
                        urgency: 'critical',
                        steps: [
                            {
                                title: 'Use Epinephrine',
                                description: 'If the person has an epinephrine auto-injector, use it immediately.',
                                illustration: 'üíâüêù'
                            },
                            {
                                title: 'Call Emergency Services',
                                description: 'Call 911 even if symptoms seem to improve.',
                                illustration: 'üìûüöë'
                            },
                            {
                                title: 'Remove Stinger',
                                description: 'Scrape stinger out with a credit card edge. Do not use tweezers.',
                                illustration: 'üí≥üêù'
                            },
                            {
                                title: 'Monitor Breathing',
                                description: 'Watch for breathing difficulties and be prepared for CPR.',
                                illustration: 'üëÇüëÄ'
                            }
                        ],
                        warning: 'If symptoms include difficulty breathing, swelling, or dizziness, treat as anaphylaxis.'
                    },
                    {
                        id: 'diabetic-emergency',
                        name: 'Diabetic Emergency',
                        description: 'Help for low or high blood sugar',
                        icon: 'ü©∫',
                        urgency: 'high',
                        steps: [
                            {
                                title: 'Check Responsiveness',
                                description: 'Determine if the person is conscious and able to swallow.',
                                illustration: 'üëãüó£Ô∏è'
                            },
                            {
                                title: 'If Conscious - Give Sugar',
                                description: 'If conscious and able to swallow, give fast-acting sugar (juice, candy, glucose gel).',
                                illustration: 'üç≠üë§'
                            },
                            {
                                title: 'If Unconscious',
                                description: 'If unconscious, do not give anything by mouth. Call 911 and monitor breathing.',
                                illustration: 'üìûüëÇ'
                            },
                            {
                                title: 'Check for Medical ID',
                                description: 'Look for medical alert bracelet or information.',
                                illustration: 'üÜîüîç'
                            }
                        ],
                        warning: 'When in doubt, give sugar. Low blood sugar is more immediately dangerous.'
                    },
                    {
                        id: 'shock',
                        name: 'Shock',
                        description: 'Treat circulatory shock',
                        icon: 'üòµ',
                        urgency: 'critical',
                        steps: [
                            {
                                title: 'Call Emergency Services',
                                description: 'Shock is life-threatening. Call 911 immediately.',
                                illustration: 'üìûüöë'
                            },
                            {
                                title: 'Have Person Lie Down',
                                description: 'Lay them on their back, unless they have head/neck/leg injuries.',
                                illustration: 'üë§‚¨áÔ∏è'
                            },
                            {
                                title: 'Elevate Legs',
                                description: 'Raise feet about 12 inches unless injuries prevent this.',
                                illustration: 'ü¶µ‚¨ÜÔ∏è'
                            },
                            {
                                title: 'Keep Warm',
                                description: 'Cover with blanket to maintain body temperature.',
                                illustration: 'üõèÔ∏èüå°Ô∏è'
                            }
                        ],
                        warning: 'Do not give anything to eat or drink.'
                    },
                    {
                        id: 'head-injury',
                        name: 'Head Injury',
                        description: 'Response to head trauma',
                        icon: 'ü§ï',
                        urgency: 'high',
                        steps: [
                            {
                                title: 'Call Emergency Services',
                                description: 'Call 911 for any serious head injury or if person loses consciousness.',
                                illustration: 'üìûüöë'
                            },
                            {
                                title: 'Keep Person Still',
                                description: 'Do not move them unless absolutely necessary.',
                                illustration: '‚õîüèÉ'
                            },
                            {
                                title: 'Control Bleeding',
                                description: 'Apply firm pressure with clean cloth to stop bleeding.',
                                illustration: 'ü©πü§ï'
                            },
                            {
                                title: 'Monitor Consciousness',
                                description: 'Watch for changes in alertness, speech, or movement.',
                                illustration: 'üëÄüß†'
                            }
                        ],
                        warning: 'Do not remove any object embedded in the head.'
                    },
                    {
                        id: 'asthma-attack',
                        name: 'Asthma Attack',
                        description: 'Emergency help for asthma',
                        icon: 'üòÆ‚Äçüí®',
                        urgency: 'critical',
                        steps: [
                            {
                                title: 'Help Use Inhaler',
                                description: 'Assist with using their prescribed inhaler or nebulizer.',
                                illustration: 'üí®üë§'
                            },
                            {
                                title: 'Call Emergency Services',
                                description: 'Call 911 if breathing doesn\'t improve quickly or if no inhaler available.',
                                illustration: 'üìûüöë'
                            },
                            {
                                title: 'Sit Upright',
                                description: 'Help them sit in a comfortable, upright position.',
                                illustration: 'üë§ü™ë'
                            },
                            {
                                title: 'Loosen Tight Clothing',
                                description: 'Remove or loosen tight clothing around neck and chest.',
                                illustration: 'üëîüîì'
                            }
                        ],
                        warning: 'If person stops breathing, begin CPR immediately.'
                    },
                    // NEW 20 PROCEDURES START HERE
                    {
                        id: 'heat-exhaustion',
                        name: 'Heat Exhaustion',
                        description: 'Cooling for heat-related illness',
                        icon: 'ü•µ',
                        urgency: 'high',
                        steps: [
                            {
                                title: 'Move to Cool Area',
                                description: 'Get person to air-conditioned room or shady spot.',
                                illustration: 'üë§üå≥'
                            },
                            {
                                title: 'Loosen Clothing',
                                description: 'Remove or loosen tight clothing to help cooling.',
                                illustration: 'üëîüîì'
                            },
                            {
                                title: 'Cool with Water',
                                description: 'Apply cool, wet cloths or take cool shower/bath.',
                                illustration: 'üíßüßä'
                            },
                            {
                                title: 'Hydrate Slowly',
                                description: 'Sip cool water or sports drink. Avoid alcohol.',
                                illustration: 'ü•§üë§'
                            }
                        ],
                        warning: 'If symptoms worsen or vomiting occurs, seek medical help immediately.'
                    },
                    {
                        id: 'frostbite',
                        name: 'Frostbite',
                        description: 'Treatment for frozen skin',
                        icon: 'üßä',
                        urgency: 'high',
                        steps: [
                            {
                                title: 'Move to Warm Area',
                                description: 'Get indoors as soon as possible.',
                                illustration: 'üë§üè†'
                            },
                            {
                                title: 'Remove Wet Clothing',
                                description: 'Take off wet clothes and jewelry from affected area.',
                                illustration: 'üëï‚û°Ô∏è'
                            },
                            {
                                title: 'Warm Gradually',
                                description: 'Soak affected area in warm (not hot) water for 15-30 minutes.',
                                illustration: 'üõÅüå°Ô∏è'
                            },
                            {
                                title: 'Avoid Rubbing',
                                description: 'Do not rub or massage frostbitten area.',
                                illustration: '‚úã‚õî'
                            }
                        ],
                        warning: 'Do not use direct heat sources like heating pads or fires.'
                    },
                    {
                        id: 'animal-bite',
                        name: 'Animal Bite',
                        description: 'First aid for animal bites',
                        icon: 'üêï',
                        urgency: 'high',
                        steps: [
                            {
                                title: 'Control Bleeding',
                                description: 'Apply pressure with clean cloth to stop bleeding.',
                                illustration: 'ü©π‚úã'
                            },
                            {
                                title: 'Clean Wound',
                                description: 'Wash thoroughly with soap and warm water.',
                                illustration: 'üßºüíß'
                            },
                            {
                                title: 'Apply Antibiotic Ointment',
                                description: 'Apply antibiotic cream if available.',
                                illustration: 'üíäü©π'
                            },
                            {
                                title: 'Cover with Bandage',
                                description: 'Use sterile dressing to cover the wound.',
                                illustration: 'ü©π‚úÖ'
                            }
                        ],
                        warning: 'Seek medical attention for animal bites as rabies and infection risk is high.'
                    },
                    {
                        id: 'insect-sting',
                        name: 'Insect Sting',
                        description: 'Treat non-allergic insect stings',
                        icon: 'üêú',
                        urgency: 'medium',
                        steps: [
                            {
                                title: 'Remove Stinger',
                                description: 'Scrape away with fingernail or credit card edge.',
                                illustration: 'üí≥üêù'
                            },
                            {
                                title: 'Wash Area',
                                description: 'Clean with soap and water.',
                                illustration: 'üßºüíß'
                            },
                            {
                                title: 'Apply Cold Compress',
                                description: 'Use ice pack to reduce swelling and pain.',
                                illustration: 'üßäü©π'
                            },
                            {
                                title: 'Take Pain Reliever',
                                description: 'Use over-the-counter pain medication if needed.',
                                illustration: 'üíäüë§'
                            }
                        ],
                        warning: 'Watch for signs of allergic reaction: difficulty breathing, swelling, hives.'
                    },
                    {
                        id: 'chemical-burn',
                        name: 'Chemical Burn',
                        description: 'Emergency chemical exposure treatment',
                        icon: 'üß™',
                        urgency: 'critical',
                        steps: [
                            {
                                title: 'Remove Contaminated Clothing',
                                description: 'Carefully remove clothing with chemical on it.',
                                illustration: 'üëï‚û°Ô∏è'
                            },
                            {
                                title: 'Rinse Continuously',
                                description: 'Flush affected area with cool running water for 20+ minutes.',
                                illustration: 'üíßüîÑ'
                            },
                            {
                                title: 'Call Poison Control',
                                description: 'Contact poison control for specific chemical advice.',
                                illustration: 'üìû‚ò†Ô∏è'
                            },
                            {
                                title: 'Cover Loosely',
                                description: 'Use sterile dressing or clean cloth to cover.',
                                illustration: 'ü©π‚úÖ'
                            }
                        ],
                        warning: 'Do not use neutralizing agents or try to neutralize the chemical.'
                    },
                    {
                        id: 'concussion',
                        name: 'Concussion',
                        description: 'Head injury with brain trauma',
                        icon: 'ü§Ø',
                        urgency: 'high',
                        steps: [
                            {
                                title: 'Monitor Closely',
                                description: 'Watch for changes in consciousness or behavior.',
                                illustration: 'üëÄüß†'
                            },
                            {
                                title: 'Rest Completely',
                                description: 'Avoid physical and mental activity.',
                                illustration: '‚õîüèÉ'
                            },
                            {
                                title: 'Apply Cold Pack',
                                description: 'Use ice pack on head to reduce swelling.',
                                illustration: 'üßäü§ï'
                            },
                            {
                                title: 'Seek Medical Evaluation',
                                description: 'Even mild concussions need professional assessment.',
                                illustration: 'üè•üë®‚Äç‚öïÔ∏è'
                            }
                        ],
                        warning: 'Do not give medications without medical advice. Avoid screens and bright lights.'
                    },
                    {
                        id: 'fainting',
                        name: 'Fainting',
                        description: 'Response to loss of consciousness',
                        icon: 'üí´',
                        urgency: 'medium',
                        steps: [
                            {
                                title: 'Lay Person Down',
                                description: 'Place on back and elevate legs 12 inches.',
                                illustration: 'üë§‚¨áÔ∏è'
                            },
                            {
                                title: 'Check Breathing',
                                description: 'Ensure airway is clear and person is breathing.',
                                illustration: 'üëÇüëÄ'
                            },
                            {
                                title: 'Loosen Tight Clothing',
                                description: 'Remove or loosen tight items around neck and waist.',
                                illustration: 'üëîüîì'
                            },
                            {
                                title: 'Monitor Recovery',
                                description: 'Most people wake within a minute. Stay with them.',
                                illustration: '‚è±Ô∏èüë§'
                            }
                        ],
                        warning: 'If person doesn\'t wake within a minute, call 911.'
                    },
                    {
                        id: 'chest-pain',
                        name: 'Chest Pain',
                        description: 'Emergency response to chest discomfort',
                        icon: 'üíî',
                        urgency: 'critical',
                        steps: [
                            {
                                title: 'Call Emergency Services',
                                description: 'Call 911 immediately for any unexplained chest pain.',
                                illustration: 'üìûüöë'
                            },
                            {
                                title: 'Sit and Rest',
                                description: 'Have person sit in comfortable position.',
                                illustration: 'üë§ü™ë'
                            },
                            {
                                title: 'Give Aspirin if Available',
                                description: 'If not allergic, give one regular aspirin to chew.',
                                illustration: 'üíäüòñ'
                            },
                            {
                                title: 'Stay Calm',
                                description: 'Keep person calm while waiting for help.',
                                illustration: 'üòåü§´'
                            }
                        ],
                        warning: 'Do not drive yourself or others to hospital. Wait for ambulance.'
                    },
                    {
                        id: 'foreign-object-eye',
                        name: 'Object in Eye',
                        description: 'Remove small particles from eye',
                        icon: 'üëÅÔ∏è‚Äçüó®Ô∏è',
                        urgency: 'medium',
                        steps: [
                            {
                                title: 'Wash Hands First',
                                description: 'Clean hands thoroughly before touching eye area.',
                                illustration: '‚úãüßº'
                            },
                            {
                                title: 'Try to Blink',
                                description: 'Blink several times to see if tears wash object out.',
                                illustration: 'üëÅÔ∏èüëÅÔ∏è'
                            },
                            {
                                title: 'Pull Upper Lid Over Lower',
                                description: 'This may dislodge object with eyelashes.',
                                illustration: 'üëÅÔ∏è‚ÜïÔ∏è'
                            },
                            {
                                title: 'Flush with Water',
                                description: 'Use clean, lukewarm water to rinse eye.',
                                illustration: 'üíßüëÅÔ∏è'
                            }
                        ],
                        warning: 'Do not rub eye. Do not try to remove object embedded in eye.'
                    },
                    {
                        id: 'jellyfish-sting',
                        name: 'Jellyfish Sting',
                        description: 'Treat marine sting injuries',
                        icon: 'üéê',
                        urgency: 'high',
                        steps: [
                            {
                                title: 'Get Out of Water',
                                description: 'Move to dry land to prevent further stings.',
                                illustration: 'üë§üèñÔ∏è'
                            },
                            {
                                title: 'Rinse with Vinegar',
                                description: 'Pour vinegar over sting for 30+ seconds.',
                                illustration: 'üß¥üíß'
                            },
                            {
                                title: 'Remove Tentacles',
                                description: 'Use tweezers to remove visible tentacles.',
                                illustration: 'üîß‚û°Ô∏è'
                            },
                            {
                                title: 'Soak in Hot Water',
                                description: 'Soak affected area in hot water (104-113¬∞F).',
                                illustration: 'üõÅüå°Ô∏è'
                            }
                        ],
                        warning: 'Do not rinse with fresh water or rub with sand. This can make sting worse.'
                    },
                    {
                        id: 'tooth-knocked-out',
                        name: 'Knocked-Out Tooth',
                        description: 'Emergency dental first aid',
                        icon: 'ü¶∑',
                        urgency: 'high',
                        steps: [
                            {
                                title: 'Handle by Crown Only',
                                description: 'Pick up tooth by the chewing surface, not root.',
                                illustration: '‚úãü¶∑'
                            },
                            {
                                title: 'Rinse Gently',
                                description: 'If dirty, rinse briefly with milk or saline.',
                                illustration: 'ü•õüíß'
                            },
                            {
                                title: 'Try to Reinsert',
                                description: 'Gently push back into socket if possible.',
                                illustration: 'ü¶∑‚Ü™Ô∏è'
                            },
                            {
                                title: 'Keep Moist',
                                description: 'If can\'t reinsert, keep in milk or saliva.',
                                illustration: 'ü•õü¶∑'
                            }
                        ],
                        warning: 'Time is critical. See dentist within 30 minutes for best chance of saving tooth.'
                    },
                    {
                        id: 'heat-rash',
                        name: 'Heat Rash',
                        description: 'Treat heat-induced skin irritation',
                        icon: 'üå°Ô∏è',
                        urgency: 'medium',
                        steps: [
                            {
                                title: 'Move to Cooler Area',
                                description: 'Get out of heat and humidity.',
                                illustration: 'üë§üå≥'
                            },
                            {
                                title: 'Keep Skin Dry',
                                description: 'Pat skin dry instead of rubbing.',
                                illustration: 'üëãüíß'
                            },
                            {
                                title: 'Wear Loose Clothing',
                                description: 'Choose lightweight, breathable fabrics.',
                                illustration: 'üëïüå¨Ô∏è'
                            },
                            {
                                title: 'Use Calamine Lotion',
                                description: 'Apply to soothe itching if needed.',
                                illustration: 'üß¥ü©π'
                            }
                        ],
                        warning: 'Do not use ointments or creams that block pores.'
                    },
                    {
                        id: 'back-injury',
                        name: 'Back Injury',
                        description: 'First aid for spinal or back trauma',
                        icon: 'ü¶¥',
                        urgency: 'critical',
                        steps: [
                            {
                                title: 'Do Not Move Person',
                                description: 'Keep person still in position found.',
                                illustration: '‚õîüèÉ'
                            },
                            {
                                title: 'Call Emergency Services',
                                description: 'Call 911 immediately for any back/spinal injury.',
                                illustration: 'üìûüöë'
                            },
                            {
                                title: 'Support Head and Neck',
                                description: 'Place hands on both sides of head to stabilize.',
                                illustration: '‚úãüß†‚úã'
                            },
                            {
                                title: 'Keep Person Warm',
                                description: 'Cover with blanket to prevent shock.',
                                illustration: 'üõèÔ∏èüå°Ô∏è'
                            }
                        ],
                        warning: 'Moving someone with back injury can cause paralysis.'
                    },
                    {
                        id: 'meningitis-suspected',
                        name: 'Meningitis Symptoms',
                        description: 'Recognize and respond to meningitis',
                        icon: 'üß†',
                        urgency: 'critical',
                        steps: [
                            {
                                title: 'Call Emergency Services',
                                description: 'Meningitis is life-threatening. Call 911 immediately.',
                                illustration: 'üìûüöë'
                            },
                            {
                                title: 'Check for Stiff Neck',
                                description: 'Person may not be able to touch chin to chest.',
                                illustration: 'üë§‚ÜîÔ∏è'
                            },
                            {
                                title: 'Look for Rash',
                                description: 'Check for non-blanching rash (doesn\'t fade when pressed).',
                                illustration: 'üîçüî¥'
                            },
                            {
                                title: 'Monitor Consciousness',
                                description: 'Watch for confusion, drowsiness, or seizures.',
                                illustration: 'üëÄüß†'
                            }
                        ],
                        warning: 'Do not wait for all symptoms to appear. Early treatment is critical.'
                    },
                    {
                        id: 'panic-attack',
                        name: 'Panic Attack',
                        description: 'Help during anxiety episode',
                        icon: 'üò∞',
                        urgency: 'medium',
                        steps: [
                            {
                                title: 'Stay Calm',
                                description: 'Your calmness will help the person feel safe.',
                                illustration: 'üòåü§ù'
                            },
                            {
                                title: 'Move to Quiet Place',
                                description: 'Reduce stimuli and overwhelming environment.',
                                illustration: 'üë§üå≥'
                            },
                            {
                                title: 'Encourage Slow Breathing',
                                description: 'Guide to breathe in for 4, hold for 4, out for 4.',
                                illustration: 'üí®‚è±Ô∏è'
                            },
                            {
                                title: 'Use Grounding Techniques',
                                description: 'Ask to name 5 things they can see, 4 they can feel, etc.',
                                illustration: 'üåç‚úã'
                            }
                        ],
                        warning: 'If symptoms include chest pain or difficulty breathing, call 911.'
                    },
                    {
                        id: 'rabies-exposure',
                        name: 'Rabies Exposure',
                        description: 'Respond to potential rabies contact',
                        icon: 'ü¶á',
                        urgency: 'critical',
                        steps: [
                            {
                                title: 'Wash Wound Thoroughly',
                                description: 'Clean bite/scratch with soap and water for 15 minutes.',
                                illustration: 'üßºüíß'
                            },
                            {
                                title: 'Apply Antiseptic',
                                description: 'Use iodine or alcohol-based solution if available.',
                                illustration: 'üß¥ü©π'
                            },
                            {
                                title: 'Call Health Department',
                                description: 'Report the bite for rabies monitoring.',
                                illustration: 'üìûüè•'
                            },
                            {
                                title: 'Seek Medical Care',
                                description: 'Rabies is fatal once symptoms appear. Prevention is key.',
                                illustration: 'üöëüë®‚Äç‚öïÔ∏è'
                            }
                        ],
                        warning: 'Do not delay medical care. Rabies is almost always fatal without treatment.'
                    },
                    {
                        id: 'splinter-removal',
                        name: 'Splinter Removal',
                        description: 'Remove embedded foreign objects',
                        icon: 'ü™µ',
                        urgency: 'medium',
                        steps: [
                            {
                                title: 'Clean Area',
                                description: 'Wash hands and affected area with soap and water.',
                                illustration: 'üßºüíß'
                            },
                            {
                                title: 'Sterilize Tools',
                                description: 'Clean tweezers with alcohol or boiling water.',
                                illustration: 'üîßüî•'
                            },
                            {
                                title: 'Grasp Splinter',
                                description: 'Use tweezers to grip end of splinter.',
                                illustration: 'üîßü™µ'
                            },
                            {
                                title: 'Pull at Same Angle',
                                description: 'Pull gently at same angle it entered.',
                                illustration: 'ü™µ‚ÜóÔ∏è'
                            }
                        ],
                        warning: 'If splinter is deep, infected, or under nail, seek medical help.'
                    },
                    {
                        id: 'sunburn',
                        name: 'Severe Sunburn',
                        description: 'Treat painful sun overexposure',
                        icon: 'üåû',
                        urgency: 'medium',
                        steps: [
                            {
                                title: 'Cool the Skin',
                                description: 'Apply cool compresses or take cool bath.',
                                illustration: 'üßäüå°Ô∏è'
                            },
                            {
                                title: 'Hydrate',
                                description: 'Drink extra water to prevent dehydration.',
                                illustration: 'üíßüë§'
                            },
                            {
                                title: 'Use Aloe Vera',
                                description: 'Apply pure aloe vera gel to soothe skin.',
                                illustration: 'üåøü©π'
                            },
                            {
                                title: 'Take Pain Reliever',
                                description: 'Use ibuprofen or acetaminophen for pain.',
                                illustration: 'üíäüë§'
                            }
                        ],
                        warning: 'If blisters cover large area, fever develops, or confusion occurs, seek medical help.'
                    },
                    {
                        id: 'tick-bite',
                        name: 'Tick Bite',
                        description: 'Safe tick removal and care',
                        icon: 'üï∑Ô∏è',
                        urgency: 'medium',
                        steps: [
                            {
                                title: 'Use Fine-Tipped Tweezers',
                                description: 'Grasp tick as close to skin surface as possible.',
                                illustration: 'üîßüï∑Ô∏è'
                            },
                            {
                                title: 'Pull Upward Steadily',
                                description: 'Pull straight out without twisting or jerking.',
                                illustration: 'üï∑Ô∏è‚¨ÜÔ∏è'
                            },
                            {
                                title: 'Clean Area',
                                description: 'Wash bite area and hands with soap and water.',
                                illustration: 'üßºüíß'
                            },
                            {
                                title: 'Save the Tick',
                                description: 'Place in sealed bag for potential testing.',
                                illustration: 'üï∑Ô∏èüì¶'
                            }
                        ],
                        warning: 'Do not use petroleum jelly, hot matches, or nail polish to remove tick.'
                    },
                    {
                        id: 'vomiting-diarrhea',
                        name: 'Severe Vomiting/Diarrhea',
                        description: 'Prevent dehydration from illness',
                        icon: 'ü§¢',
                        urgency: 'high',
                        steps: [
                            {
                                title: 'Sip Clear Liquids',
                                description: 'Take small, frequent sips of water or electrolyte solution.',
                                illustration: 'üíßüë§'
                            },
                            {
                                title: 'Use BRAT Diet',
                                description: 'Bananas, Rice, Applesauce, Toast when able to eat.',
                                illustration: 'üçåüçö'
                            },
                            {
                                title: 'Rest',
                                description: 'Allow body to recover with plenty of rest.',
                                illustration: 'üõèÔ∏èüë§'
                            },
                            {
                                title: 'Watch for Dehydration',
                                description: 'Monitor for dry mouth, dark urine, dizziness.',
                                illustration: 'üëÄüíß'
                            }
                        ],
                        warning: 'If unable to keep liquids down for 24 hours, blood in stool/vomit, or signs of dehydration, seek medical help.'
                    },
                    {
                        id: 'workshop-injury',
                        name: 'Workshop/Tool Injury',
                        description: 'First aid for tool-related accidents',
                        icon: 'üõ†Ô∏è',
                        urgency: 'high',
                        steps: [
                            {
                                title: 'Stop Work Immediately',
                                description: 'Shut off all power tools and machinery.',
                                illustration: 'üîå‚ùå'
                            },
                            {
                                title: 'Control Bleeding',
                                description: 'Apply direct pressure with clean cloth.',
                                illustration: 'ü©π‚úã'
                            },
                            {
                                title: 'Check for Amputations',
                                description: 'If body part severed, preserve it properly.',
                                illustration: 'üñêÔ∏èüì¶'
                            },
                            {
                                title: 'Call Emergency Services',
                                description: 'Workshop injuries often need specialized care.',
                                illustration: 'üìûüöë'
                            }
                        ],
                        warning: 'Do not remove deeply embedded objects. Stabilize and seek medical help.'
                    }
                ],
                contacts: [
                    { id: 1, name: 'Emergency Services', number: '911', icon: 'üöë' },
                    { id: 2, name: 'Poison Control', number: '1-800-222-1222', icon: '‚ò†Ô∏è' },
                    { id: 3, name: 'Doctor', number: '(555) 123-4567', icon: 'üë®‚Äç‚öïÔ∏è' }
                ],
                medicalNotes: '',
                settings: {
                    theme: 'light',
                    animationSpeed: 'normal',
                    defaultView: 'detail',
                    autoSave: true,
                    largeText: false
                },
                timer: {
                    running: false,
                    timeLeft: 120, // seconds
                    interval: null
                }
            };

            const saveState = () => {
                if (state.settings.autoSave) {
                    localStorage.setItem('aidkit_state', JSON.stringify({
                        contacts: state.contacts,
                        medicalNotes: state.medicalNotes,
                        settings: state.settings,
                        currentProcedure: state.currentProcedure
                    }));
                }
            };

            const loadState = () => {
                try {
                    const saved = JSON.parse(localStorage.getItem('aidkit_state'));
                    if (saved) {
                        state.contacts = saved.contacts || state.contacts;
                        state.medicalNotes = saved.medicalNotes || '';
                        state.settings = { ...state.settings, ...saved.settings };
                        state.currentProcedure = saved.currentProcedure || null;
                        return true;
                    }
                } catch (e) {
                    console.warn('Failed to load saved state:', e);
                }
                return false;
            };

            const resetState = () => {
                localStorage.removeItem('aidkit_state');
                state.contacts = state.contacts.slice(0, 3); // Keep only default contacts
                state.medicalNotes = '';
                state.settings = {
                    theme: 'light',
                    animationSpeed: 'normal',
                    defaultView: 'detail',
                    autoSave: true,
                    largeText: false
                };
                state.currentProcedure = null;
            };

            return {
                getState: () => ({ ...state }),
                setState: (updates) => {
                    state = { ...state, ...updates };
                    saveState();
                },
                updateProcedure: (procedureId) => {
                    state.currentProcedure = procedureId;
                    saveState();
                },
                updateContacts: (contacts) => {
                    state.contacts = contacts;
                    saveState();
                },
                updateMedicalNotes: (notes) => {
                    state.medicalNotes = notes;
                    saveState();
                },
                updateSettings: (settings) => {
                    state.settings = { ...state.settings, ...settings };
                    saveState();
                },
                loadState,
                resetState,
                saveState
            };
        })();

        // ===== THEME SYSTEM MODULE =====
        const ThemeSystem = (() => {
            const themes = {
                light: {
                    name: 'Light',
                    colors: {
                        '--primary-50': '#e8f4ff',
                        '--primary-100': '#cce4ff',
                        '--primary-500': '#1a73e8',
                        '--primary-600': '#0d62d9',
                        '--surface-0': '#ffffff',
                        '--surface-50': '#f8f9fa',
                        '--surface-100': '#f1f3f4',
                        '--surface-200': '#e8eaed',
                        '--surface-900': '#202124',
                        '--text-primary': '#202124',
                        '--text-secondary': '#5f6368',
                        '--text-disabled': '#9aa0a6',
                        '--success': '#0d9d58',
                        '--warning': '#f9ab00',
                        '--danger': '#d93025'
                    },
                    preview: '#1a73e8'
                },
                dark: {
                    name: 'Dark',
                    colors: {
                        '--primary-50': '#0d1117',
                        '--primary-100': '#161b22',
                        '--primary-500': '#58a6ff',
                        '--primary-600': '#79c0ff',
                        '--surface-0': '#0d1117',
                        '--surface-50': '#161b22',
                        '--surface-100': '#21262d',
                        '--surface-200': '#30363d',
                        '--surface-900': '#ffffff',
                        '--text-primary': '#ffffff',
                        '--text-secondary': '#8b949e',
                        '--text-disabled': '#484f58',
                        '--success': '#3fb950',
                        '--warning': '#d29922',
                        '--danger': '#f85149'
                    },
                    preview: '#0d1117'
                },
                blue: {
                    name: 'Ocean',
                    colors: {
                        '--primary-50': '#e3f2fd',
                        '--primary-100': '#bbdefb',
                        '--primary-500': '#2196f3',
                        '--primary-600': '#1e88e5',
                        '--surface-0': '#ffffff',
                        '--surface-50': '#f5f9ff',
                        '--surface-100': '#e3ecff',
                        '--surface-200': '#c5d6ff',
                        '--surface-900': '#1a237e',
                        '--text-primary': '#1a237e',
                        '--text-secondary': '#5c6bc0',
                        '--text-disabled': '#9fa8da',
                        '--success': '#00c853',
                        '--warning': '#ff9100',
                        '--danger': '#ff1744'
                    },
                    preview: '#2196f3'
                },
                green: {
                    name: 'Forest',
                    colors: {
                        '--primary-50': '#e8f5e9',
                        '--primary-100': '#c8e6c9',
                        '--primary-500': '#4caf50',
                        '--primary-600': '#43a047',
                        '--surface-0': '#ffffff',
                        '--surface-50': '#f1f8e9',
                        '--surface-100': '#dcedc8',
                        '--surface-200': '#c5e1a5',
                        '--surface-900': '#1b5e20',
                        '--text-primary': '#1b5e20',
                        '--text-secondary': '#558b2f',
                        '--text-disabled': '#9ccc65',
                        '--success': '#2e7d32',
                        '--warning': '#ef6c00',
                        '--danger': '#c62828'
                    },
                    preview: '#4caf50'
                },
                purple: {
                    name: 'Royal',
                    colors: {
                        '--primary-50': '#f3e5f5',
                        '--primary-100': '#e1bee7',
                        '--primary-500': '#9c27b0',
                        '--primary-600': '#8e24aa',
                        '--surface-0': '#ffffff',
                        '--surface-50': '#faf4ff',
                        '--surface-100': '#f3e5ff',
                        '--surface-200': '#e1bee7',
                        '--surface-900': '#4a148c',
                        '--text-primary': '#4a148c',
                        '--text-secondary': '#7b1fa2',
                        '--text-disabled': '#ba68c8',
                        '--success': '#7b1fa2',
                        '--warning': '#ff6f00',
                        '--danger': '#d81b60'
                    },
                    preview: '#9c27b0'
                },
                orange: {
                    name: 'Sunset',
                    colors: {
                        '--primary-50': '#fff3e0',
                        '--primary-100': '#ffe0b2',
                        '--primary-500': '#ff9800',
                        '--primary-600': '#fb8c00',
                        '--surface-0': '#ffffff',
                        '--surface-50': '#fff8e1',
                        '--surface-100': '#ffecb3',
                        '--surface-200': '#ffe082',
                        '--surface-900': '#e65100',
                        '--text-primary': '#e65100',
                        '--text-secondary': '#ff9800',
                        '--text-disabled': '#ffb74d',
                        '--success': '#558b2f',
                        '--warning': '#ff8f00',
                        '--danger': '#dd2c00'
                    },
                    preview: '#ff9800'
                },
                slate: {
                    name: 'Slate',
                    colors: {
                        '--primary-50': '#eceff1',
                        '--primary-100': '#cfd8dc',
                        '--primary-500': '#607d8b',
                        '--primary-600': '#546e7a',
                        '--surface-0': '#ffffff',
                        '--surface-50': '#fafafa',
                        '--surface-100': '#f5f5f5',
                        '--surface-200': '#eeeeee',
                        '--surface-900': '#263238',
                        '--text-primary': '#263238',
                        '--text-secondary': '#546e7a',
                        '--text-disabled': '#90a4ae',
                        '--success': '#2e7d32',
                        '--warning': '#ff8f00',
                        '--danger': '#c62828'
                    },
                    preview: '#607d8b'
                }
            };

            const applyTheme = (themeName) => {
                const theme = themes[themeName];
                if (!theme) return;

                const root = document.documentElement;
                
                // Remove all theme classes
                root.classList.remove('theme-dark', 'theme-light');
                
                // Add base theme class
                if (themeName === 'dark') {
                    root.classList.add('theme-dark');
                } else {
                    root.classList.add('theme-light');
                }
                
                // Apply CSS variables
                Object.entries(theme.colors).forEach(([property, value]) => {
                    root.style.setProperty(property, value);
                });

                // Update state
                AppState.updateSettings({ theme: themeName });
            };

            const getThemeOptions = () => {
                return Object.entries(themes).map(([id, theme]) => ({
                    id,
                    name: theme.name,
                    preview: theme.preview
                }));
            };

            return { applyTheme, getThemeOptions };
        })();

        // ===== UI RENDERER MODULE =====
        const UIRenderer = (() => {
            const renderProcedureList = (procedures, searchTerm = '') => {
                const container = document.getElementById('procedureList');
                if (!container) return;

                const filteredProcedures = procedures.filter(proc =>
                    proc.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    proc.description.toLowerCase().includes(searchTerm.toLowerCase())
                );

                const currentProc = AppState.getState().currentProcedure;

                container.innerHTML = filteredProcedures.map(proc => `
                    <li class="procedure-item ${currentProc === proc.id ? 'active' : ''}" 
                        data-id="${proc.id}">
                        <div class="procedure-icon">${proc.icon}</div>
                        <div class="procedure-info">
                            <div class="procedure-name">${proc.name}</div>
                            <div class="procedure-desc">${proc.description}</div>
                        </div>
                        <div class="urgency-badge urgency-${proc.urgency}">
                            ${proc.urgency === 'critical' ? 'Critical' : 
                              proc.urgency === 'high' ? 'High' : 'Medium'}
                        </div>
                    </li>
                `).join('');
            };

            const renderProcedureDetail = (procedure) => {
                if (!procedure) {
                    document.getElementById('currentProcedureTitle').textContent = 'Select a Procedure';
                    document.getElementById('stepsContainer').innerHTML = `
                        <div class="text-center text-muted mt-2">
                            Select a procedure from the list to view instructions
                        </div>
                    `;
                    return;
                }

                document.getElementById('currentProcedureTitle').textContent = procedure.name;
                
                const stepsHtml = procedure.steps.map((step, index) => `
                    <div class="step-card">
                        <div>
                            <div class="step-number">${index + 1}</div>
                        </div>
                        <div class="step-content">
                            <h3 class="step-title">${step.title}</h3>
                            <p class="step-description">${step.description}</p>
                            <div class="step-illustration">
                                <div class="illustration-svg" style="font-size: 3rem;">
                                    ${step.illustration}
                                </div>
                            </div>
                        </div>
                    </div>
                `).join('');

                let warningHtml = '';
                if (procedure.warning) {
                    warningHtml = `
                        <div class="warning-box">
                            <div class="warning-title">‚ö†Ô∏è Important Warning</div>
                            <p>${procedure.warning}</p>
                        </div>
                    `;
                }

                document.getElementById('stepsContainer').innerHTML = stepsHtml + warningHtml;
            };

            const renderContacts = (contacts) => {
                const container = document.getElementById('contactList');
                if (!container) return;

                container.innerHTML = contacts.map(contact => `
                    <div class="contact-item" data-id="${contact.id}">
                        <div class="contact-icon">${contact.icon}</div>
                        <div class="contact-info">
                            <div class="contact-name">${contact.name}</div>
                            <div class="contact-number">${contact.number}</div>
                        </div>
                        <button class="btn btn-icon edit-contact-btn" title="Edit contact">
                            ‚úèÔ∏è
                        </button>
                    </div>
                `).join('');
            };

            const renderThemeOptions = () => {
                const container = document.getElementById('themeGrid');
                if (!container) return;

                const themes = ThemeSystem.getThemeOptions();
                const currentTheme = AppState.getState().settings.theme;

                container.innerHTML = themes.map(theme => `
                    <div class="theme-option ${currentTheme === theme.id ? 'active' : ''}" 
                         data-theme="${theme.id}">
                        <div class="theme-preview" style="background: ${theme.preview}"></div>
                        <div class="theme-name">${theme.name}</div>
                    </div>
                `).join('');
            };

            return {
                renderProcedureList,
                renderProcedureDetail,
                renderContacts,
                renderThemeOptions
            };
        })();

        // ===== EVENT HANDLER MODULE =====
        const EventHandlers = (() => {
            let speechSynthesis = null;
            let isAudioPlaying = false;
            let currentUtterances = [];
            let currentUtteranceIndex = 0;

            const init = () => {
                // Load saved state
                AppState.loadState();
                
                // Apply saved theme
                const { settings } = AppState.getState();
                ThemeSystem.applyTheme(settings.theme);
                
                // Initial render
                const { procedures, contacts } = AppState.getState();
                UIRenderer.renderProcedureList(procedures);
                UIRenderer.renderContacts(contacts);
                UIRenderer.renderThemeOptions();
                
                // Restore medical notes
                document.getElementById('medicalNotes').value = AppState.getState().medicalNotes;
                
                // Restore current procedure
                const { currentProcedure } = AppState.getState();
                if (currentProcedure) {
                    const proc = procedures.find(p => p.id === currentProcedure);
                    if (proc) {
                        UIRenderer.renderProcedureDetail(proc);
                    }
                }

                // Setup speech synthesis
                if ('speechSynthesis' in window) {
                    speechSynthesis = window.speechSynthesis;
                    
                    // Handle speech synthesis events
                    speechSynthesis.onend = () => {
                        if (currentUtteranceIndex < currentUtterances.length - 1) {
                            // Play next utterance
                            currentUtteranceIndex++;
                            speechSynthesis.speak(currentUtterances[currentUtteranceIndex]);
                        } else {
                            // All utterances complete
                            stopAudio();
                        }
                    };
                    
                    speechSynthesis.onerror = () => {
                        stopAudio();
                    };
                }
            };

            const stopAudio = () => {
                if (speechSynthesis) {
                    speechSynthesis.cancel();
                }
                isAudioPlaying = false;
                currentUtterances = [];
                currentUtteranceIndex = 0;
                updateAudioButton();
            };

            const pauseAudio = () => {
                if (speechSynthesis && isAudioPlaying) {
                    speechSynthesis.pause();
                    isAudioPlaying = false;
                    updateAudioButton();
                }
            };

            const resumeAudio = () => {
                if (speechSynthesis && !isAudioPlaying && currentUtterances.length > 0) {
                    speechSynthesis.resume();
                    isAudioPlaying = true;
                    updateAudioButton();
                }
            };

            const startAudio = (procedure) => {
                if (!speechSynthesis) {
                    alert('Text-to-speech is not supported by your browser.');
                    return;
                }

                if (!procedure) {
                    alert('Please select a procedure first.');
                    return;
                }

                // Stop any ongoing speech
                stopAudio();

                // Create utterances for each step
                currentUtterances = [];
                
                procedure.steps.forEach((step, index) => {
                    const utterance = new SpeechSynthesisUtterance(
                        `Step ${index + 1}: ${step.title}. ${step.description}`
                    );
                    utterance.rate = 0.9;
                    utterance.volume = 1.0;
                    currentUtterances.push(utterance);
                });

                if (procedure.warning) {
                    const warningUtterance = new SpeechSynthesisUtterance(
                        `Warning: ${procedure.warning}`
                    );
                    warningUtterance.rate = 0.9;
                    warningUtterance.volume = 1.0;
                    currentUtterances.push(warningUtterance);
                }

                if (currentUtterances.length > 0) {
                    currentUtteranceIndex = 0;
                    speechSynthesis.speak(currentUtterances[0]);
                    isAudioPlaying = true;
                    updateAudioButton();
                }
            };

            const updateAudioButton = () => {
                const audioBtn = document.getElementById('audioBtn');
                if (!audioBtn) return;

                if (isAudioPlaying) {
                    audioBtn.innerHTML = '‚è∏Ô∏è Pause';
                    audioBtn.title = 'Pause audio guide';
                } else {
                    audioBtn.innerHTML = 'üîä Audio';
                    audioBtn.title = 'Play audio guide';
                }
            };

            const toggleAudio = () => {
                const { currentProcedure, procedures } = AppState.getState();
                const procedure = procedures.find(p => p.id === currentProcedure);
                
                if (!procedure) {
                    alert('Please select a procedure first.');
                    return;
                }

                if (!speechSynthesis) {
                    alert('Text-to-speech is not supported by your browser.');
                    return;
                }

                if (isAudioPlaying) {
                    pauseAudio();
                } else {
                    if (speechSynthesis.speaking && speechSynthesis.paused) {
                        resumeAudio();
                    } else {
                        startAudio(procedure);
                    }
                }
            };

            const setupEventListeners = () => {
                // Search input
                document.getElementById('searchInput').addEventListener('input', (e) => {
                    const { procedures } = AppState.getState();
                    UIRenderer.renderProcedureList(procedures, e.target.value);
                });

                // Procedure list clicks
                document.getElementById('procedureList').addEventListener('click', (e) => {
                    const item = e.target.closest('.procedure-item');
                    if (!item) return;

                    const procedureId = item.dataset.id;
                    const { procedures } = AppState.getState();
                    const procedure = procedures.find(p => p.id === procedureId);
                    
                    if (procedure) {
                        // Stop audio when changing procedure
                        stopAudio();
                        
                        AppState.updateProcedure(procedureId);
                        UIRenderer.renderProcedureDetail(procedure);
                        UIRenderer.renderProcedureList(procedures, document.getElementById('searchInput').value);
                    }
                });

                // Medical notes auto-save
                document.getElementById('medicalNotes').addEventListener('input', (e) => {
                    AppState.updateMedicalNotes(e.target.value);
                });

                // Emergency call button
                document.getElementById('emergencyCallBtn').addEventListener('click', () => {
                    if (confirm('Call emergency services? This will use your phone\'s dialer.')) {
                        window.open('tel:911');
                    }
                });

                // Print button
                document.getElementById('printBtn').addEventListener('click', () => {
                    const { currentProcedure, procedures, medicalNotes } = AppState.getState();
                    const procedure = procedures.find(p => p.id === currentProcedure);
                    
                    if (!procedure) {
                        alert('Please select a procedure to print.');
                        return;
                    }

                    const printWindow = window.open('', '_blank');
                    printWindow.document.write(`
                        <html>
                            <head>
                                <title>${procedure.name} - AidKit</title>
                                <style>
                                    body { font-family: Arial, sans-serif; line-height: 1.6; padding: 20px; }
                                    h1 { color: #333; }
                                    .step { margin-bottom: 20px; padding: 15px; border-left: 4px solid #1a73e8; background: #f8f9fa; }
                                    .warning { background: #fff8e1; border-left: 4px solid #f9ab00; padding: 15px; margin: 20px 0; }
                                    .notes { margin-top: 30px; padding: 15px; border: 1px solid #ddd; }
                                </style>
                            </head>
                            <body>
                                <h1>${procedure.name}</h1>
                                <p><em>Printed from AidKit First-Aid Guide</em></p>
                                
                                ${procedure.steps.map((step, i) => `
                                    <div class="step">
                                        <h3>Step ${i + 1}: ${step.title}</h3>
                                        <p>${step.description}</p>
                                    </div>
                                `).join('')}
                                
                                ${procedure.warning ? `
                                    <div class="warning">
                                        <strong>‚ö†Ô∏è Important Warning:</strong> ${procedure.warning}
                                    </div>
                                ` : ''}
                                
                                ${medicalNotes ? `
                                    <div class="notes">
                                        <h3>Personal Medical Notes:</h3>
                                        <p>${medicalNotes.replace(/\n/g, '<br>')}</p>
                                    </div>
                                ` : ''}
                                
                                <script>
                                    window.onload = () => window.print();
                                <\/script>
                            </body>
                        </html>
                    `);
                    printWindow.document.close();
                });

                // Audio button with play/pause functionality
                document.getElementById('audioBtn').addEventListener('click', toggleAudio);

                // Timer button
                document.getElementById('timerBtn').addEventListener('click', () => {
                    document.getElementById('timerModal').classList.add('active');
                });

                // Theme button
                document.getElementById('themeBtn').addEventListener('click', () => {
                    document.getElementById('themeModal').classList.add('active');
                });

                // Settings button
                document.getElementById('settingsBtn').addEventListener('click', () => {
                    const { settings } = AppState.getState();
                    document.getElementById('animationSpeed').value = settings.animationSpeed;
                    document.getElementById('defaultView').value = settings.defaultView;
                    document.getElementById('autoSave').checked = settings.autoSave;
                    document.getElementById('largeText').checked = settings.largeText;
                    document.getElementById('settingsModal').classList.add('active');
                });

                // Export button
                document.getElementById('exportBtn').addEventListener('click', () => {
                    const state = AppState.getState();
                    const exportData = {
                        contacts: state.contacts,
                        medicalNotes: state.medicalNotes,
                        settings: state.settings,
                        exportDate: new Date().toISOString(),
                        app: 'AidKit'
                    };

                    const blob = new Blob([JSON.stringify(exportData, null, 2)], {
                        type: 'application/json'
                    });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `aidkit-backup-${new Date().toISOString().split('T')[0]}.json`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);

                    alert('Data exported successfully!');
                });

                // Import functionality
                document.getElementById('importFile').addEventListener('change', (e) => {
                    const file = e.target.files[0];
                    if (!file) return;

                    const reader = new FileReader();
                    reader.onload = (event) => {
                        try {
                            const data = JSON.parse(event.target.result);
                            
                            // Validate import data
                            if (!data.app || data.app !== 'AidKit') {
                                throw new Error('Invalid backup file');
                            }

                            if (confirm('Import this backup? This will replace your current data.')) {
                                if (data.contacts) AppState.updateContacts(data.contacts);
                                if (data.medicalNotes !== undefined) {
                                    AppState.updateMedicalNotes(data.medicalNotes);
                                    document.getElementById('medicalNotes').value = data.medicalNotes;
                                }
                                if (data.settings) {
                                    AppState.updateSettings(data.settings);
                                    ThemeSystem.applyTheme(data.settings.theme);
                                }
                                
                                UIRenderer.renderContacts(data.contacts);
                                UIRenderer.renderThemeOptions();
                                alert('Data imported successfully!');
                            }
                        } catch (err) {
                            alert('Failed to import: Invalid backup file format.');
                            console.error(err);
                        }
                    };
                    reader.readAsText(file);
                    e.target.value = '';
                });

                // Guide button
                document.getElementById('guideBtn').addEventListener('click', () => {
                    document.getElementById('guideModal').classList.add('active');
                });

                // Add contact button
                document.getElementById('addContactBtn').addEventListener('click', () => {
                    const name = prompt('Contact name:');
                    if (!name) return;

                    const number = prompt('Phone number:');
                    if (!number) return;

                    const icons = ['üöë', 'üë®‚Äç‚öïÔ∏è', 'üë©‚Äç‚öïÔ∏è', 'üè•', 'üìû', 'üë§'];
                    const randomIcon = icons[Math.floor(Math.random() * icons.length)];

                    const { contacts } = AppState.getState();
                    const newContact = {
                        id: Date.now(),
                        name,
                        number,
                        icon: randomIcon
                    };

                    AppState.updateContacts([...contacts, newContact]);
                    UIRenderer.renderContacts([...contacts, newContact]);
                });

                // Contact edit buttons (delegated)
                document.getElementById('contactList').addEventListener('click', (e) => {
                    if (!e.target.classList.contains('edit-contact-btn')) return;
                    
                    const contactItem = e.target.closest('.contact-item');
                    const contactId = parseInt(contactItem.dataset.id);
                    const { contacts } = AppState.getState();
                    const contact = contacts.find(c => c.id === contactId);
                    
                    if (!contact) return;

                    const newName = prompt('Edit contact name:', contact.name);
                    if (newName === null) return;

                    const newNumber = prompt('Edit phone number:', contact.number);
                    if (newNumber === null) return;

                    const updatedContacts = contacts.map(c =>
                        c.id === contactId ? { ...c, name: newName, number: newNumber } : c
                    );

                    AppState.updateContacts(updatedContacts);
                    UIRenderer.renderContacts(updatedContacts);
                });

                // Theme selection
                document.getElementById('themeGrid').addEventListener('click', (e) => {
                    const themeOption = e.target.closest('.theme-option');
                    if (!themeOption) return;

                    const themeId = themeOption.dataset.theme;
                    ThemeSystem.applyTheme(themeId);
                    UIRenderer.renderThemeOptions();
                });

                // Save settings
                document.getElementById('saveSettingsBtn').addEventListener('click', () => {
                    const settings = {
                        animationSpeed: document.getElementById('animationSpeed').value,
                        defaultView: document.getElementById('defaultView').value,
                        autoSave: document.getElementById('autoSave').checked,
                        largeText: document.getElementById('largeText').checked
                    };

                    AppState.updateSettings(settings);
                    
                    if (settings.largeText) {
                        document.body.style.fontSize = '1.1em';
                    } else {
                        document.body.style.fontSize = '';
                    }

                    document.getElementById('settingsModal').classList.remove('active');
                    alert('Settings saved!');
                });

                // Reset settings
                document.getElementById('resetSettingsBtn').addEventListener('click', () => {
                    if (confirm('Reset all settings to defaults?')) {
                        AppState.resetState();
                        ThemeSystem.applyTheme('light');
                        UIRenderer.renderContacts(AppState.getState().contacts);
                        UIRenderer.renderThemeOptions();
                        document.getElementById('medicalNotes').value = '';
                        document.getElementById('settingsModal').classList.remove('active');
                        alert('Settings reset to defaults!');
                    }
                });

                // Offline save button
                document.getElementById('offlineBtn').addEventListener('click', () => {
                    if ('serviceWorker' in navigator) {
                        alert('This page is already offline-capable! Save this page (Ctrl+S) or add to home screen.');
                    } else {
                        alert('This app works offline! Save this page (Ctrl+S or File ‚Üí Save Page) to use without internet.');
                    }
                });

                // Timer controls
                let timerInterval = null;
                let timerSeconds = 120;

                document.getElementById('startTimerBtn').addEventListener('click', () => {
                    if (timerInterval) clearInterval(timerInterval);
                    
                    timerInterval = setInterval(() => {
                        timerSeconds--;
                        if (timerSeconds <= 0) {
                            clearInterval(timerInterval);
                            timerSeconds = 120;
                            document.getElementById('timerDisplay').textContent = '02:00';
                            // Try to play beep sound
                            try {
                                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                                const oscillator = audioContext.createOscillator();
                                const gainNode = audioContext.createGain();
                                
                                oscillator.connect(gainNode);
                                gainNode.connect(audioContext.destination);
                                
                                oscillator.frequency.value = 800;
                                oscillator.type = 'sine';
                                
                                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 1);
                                
                                oscillator.start(audioContext.currentTime);
                                oscillator.stop(audioContext.currentTime + 1);
                            } catch (e) {
                                // Fallback to silent timer
                                console.log('Timer complete');
                            }
                            return;
                        }
                        
                        const mins = Math.floor(timerSeconds / 60).toString().padStart(2, '0');
                        const secs = (timerSeconds % 60).toString().padStart(2, '0');
                        document.getElementById('timerDisplay').textContent = `${mins}:${secs}`;
                    }, 1000);
                });

                document.getElementById('pauseTimerBtn').addEventListener('click', () => {
                    if (timerInterval) {
                        clearInterval(timerInterval);
                        timerInterval = null;
                    }
                });

                document.getElementById('resetTimerBtn').addEventListener('click', () => {
                    if (timerInterval) clearInterval(timerInterval);
                    timerSeconds = 120;
                    document.getElementById('timerDisplay').textContent = '02:00';
                });

                // Modal close buttons
                const closeButtons = [
                    ['closeThemeModal', 'themeModal'],
                    ['closeSettingsModal', 'settingsModal'],
                    ['closeGuideModal', 'guideModal'],
                    ['closeTimerModal', 'timerModal'],
                    ['closeGuideBtn', 'guideModal']
                ];

                closeButtons.forEach(([btnId, modalId]) => {
                    document.getElementById(btnId)?.addEventListener('click', () => {
                        document.getElementById(modalId).classList.remove('active');
                    });
                });

                // Close modals on overlay click
                document.querySelectorAll('.modal-overlay').forEach(overlay => {
                    overlay.addEventListener('click', (e) => {
                        if (e.target === overlay) {
                            overlay.classList.remove('active');
                        }
                    });
                });

                // Keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    // Escape closes modals and stops audio
                    if (e.key === 'Escape') {
                        document.querySelectorAll('.modal-overlay.active').forEach(modal => {
                            modal.classList.remove('active');
                        });
                        stopAudio();
                    }
                    
                    // Ctrl+F focuses search
                    if (e.ctrlKey && e.key === 'f') {
                        e.preventDefault();
                        document.getElementById('searchInput').focus();
                    }
                    
                    // Ctrl+P triggers print
                    if (e.ctrlKey && e.key === 'p') {
                        e.preventDefault();
                        document.getElementById('printBtn').click();
                    }
                    
                    // Space toggles audio (when not in input field)
                    if (e.key === ' ' && !['INPUT', 'TEXTAREA'].includes(document.activeElement.tagName)) {
                        e.preventDefault();
                        toggleAudio();
                    }
                });

                // Stop audio when page loses focus
                document.addEventListener('visibilitychange', () => {
                    if (document.hidden) {
                        pauseAudio();
                    }
                });
            };

            return { 
                init, 
                setupEventListeners,
                stopAudio // Export for use elsewhere
            };
        })();

        // ===== APPLICATION INITIALIZATION =====
        (() => {
            // Initialize app
            EventHandlers.init();
            
            // Setup event listeners
            EventHandlers.setupEventListeners();
            
            // Show welcome message
            setTimeout(() => {
                const { currentProcedure } = AppState.getState();
                if (!currentProcedure) {
                    console.log('AidKit loaded! Select a procedure to begin.');
                    console.log('Total procedures available: 41');
                }
            }, 500);
        })();
    </script>
</body>
</html>